<!DOCTYPE html>
<html lang="fr" data-theme="<%= typeof theme !== 'undefined' ? theme : 'default' %>">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Dartboard - Choisissez votre jeu</title>

  <!-- CSS  -->
  <link href="../../css/font-awesome.css" rel="stylesheet">
  <link href="../../css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="../../css/theme-base.css" type="text/css" rel="stylesheet"/>
  <link href="../../css/themes/<%= typeof theme !== 'undefined' ? theme : 'default' %>.css" type="text/css" rel="stylesheet"/>

</head>
<body>
  <!-- Effet de fond -->
  <div class="background-effect"></div>
  
  <div class="section no-pad-bot" id="index-banner">
    <div class="section">
        <!--   Icon Section   -->
        <div class="row">
          <div class="col s12 m2">
            <!-- Logo ou image à gauche si nécessaire -->
          </div>
          <div class="col s12 m8">
            <div class="icon-block">
              <div class="center titleMenu">Choisissez le jeu</div>
            </div>
          </div>
          <div class="col s12 m2">
            <div class="icon-block">
              <div class="center titleMenuLeft">Ni</div>
            </div>
          </div>
          <div class="col s12 m1">
          </div>
          <div class="col s12 m7 choiceGameSection">
            <div class="row">
              <div class="col m4">
                <div class="box boxGame1 selected" data-name="lobby/crickets">
                  <span></span>
                  <span></span>
                  <div class="content">
                    <h2>crickets</h2>
                    <div class="game-icon">
                      <i class="fa fa-bullseye"></i>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col m4">
                <div class="box boxGame2" data-name="lobby/01">
                  <span></span>
                  <span></span>
                  <div class="content">
                    <h2>01 Games</h2>
                    <div class="game-icon">
                      <i class="fa fa-trophy"></i>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col m4">
                <div class="box boxGame3" data-name="lobby/fungames">
                  <span></span>
                  <span></span>
                  <div class="content">
                    <h2>Fun games</h2>
                    <div class="game-icon">
                      <i class="fa fa-gamepad"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col s12 m3">
            <div class="box boxLastGame">
              <span></span>
              <span></span>
              <div class="content">
                <h2>Dernières Parties</h2>
                <div class="recent-games-table">
                  <% if (typeof recentGames !== 'undefined' && recentGames.length > 0) { %>
                    <table class="compact-table">
                      <thead>
                        <tr>
                          <th>Type</th>
                          <th>Date</th>
                          <th>Gagnant</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% recentGames.forEach(function(game) { %>
                          <tr>
                            <td><%= game.type %></td>
                            <td><%= game.formattedDate %></td>
                            <td class="winner-cell"><i class="fa fa-trophy trophy-icon"></i> <%= game.winner %></td>
                          </tr>
                        <% }); %>
                      </tbody>
                    </table>
                  <% } else { %>
                    <div class="no-games">
                      <p>Aucune partie récente</p>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
            
            <!-- Nouveau bloc pour les statistiques -->
            <div class="box boxStats" data-name="statistics" style="margin-top: 20px;">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
              <div class="content">
                <h2>Statistiques</h2>
                <div class="stats-content">
                  <p>Consultez les performances des joueurs et les dernières parties.</p>
                  <i class="fa fa-bar-chart stats-icon"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col s12 m1">
          </div>
        </div>
      </div>
    <a href="/settings" class="settings-link"><i class="fa fa-cog" aria-hidden="true"></i></a>
    
    <!-- Information sur le jeu sélectionné -->
    <div class="game-mode-info">
      Mode de jeu : <span id="selected-game-name">Cricket</span>
    </div>
  </div>
  
  <!--  Scripts-->
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/materialize.min.js"></script>
  <script src="../../js/socket.io.js"></script>

  <script>
    var socket = io();
    let gameSelected = 1;
    let nbTotalGame = 3;
    let lastMsg = '';
    
    // Noms des jeux pour l'affichage
    const gameNames = ['Cricket', '01 Games', 'Fun Games'];
    
    // Mettre à jour l'information du jeu sélectionné
    function updateSelectedGameInfo() {
      $('#selected-game-name').text(gameNames[gameSelected-1]);
    }
    
    // Initialiser l'information du jeu sélectionné
    updateSelectedGameInfo();
    
    // Ajouter des effets visuels lors de la sélection
    $('.box').click(function() {
      if ($(this).hasClass('boxLastGame') || $(this).hasClass('boxStats')) {
        // Si c'est le bloc de règles ou de statistiques, ne pas changer la sélection des jeux
        // mais rediriger vers la page appropriée si nécessaire
        if ($(this).hasClass('boxStats')) {
          window.location.href = "/statistics";
        }
        return;
      }
      
      $('.box').removeClass('selected');
      $(this).addClass('selected');
      
      // Obtenir l'index du jeu sélectionné
      gameSelected = $(this).hasClass('boxGame1') ? 1 : 
                     $(this).hasClass('boxGame2') ? 2 : 
                     $(this).hasClass('boxGame3') ? 3 : gameSelected;
      
      updateSelectedGameInfo();
    });

    socket.on('arduino', function(msg) {
      arduinoEvent(msg);
    });

    function arduinoEvent(msg){
      if(lastMsg === '') {
        lastMsg = msg;
        if(msg === 'btnNext'){
          if(gameSelected < nbTotalGame){
            gameSelected++;
          }else{
            gameSelected=1
          }
          $('.box').removeClass('selected');
          $('.boxGame'+gameSelected).addClass('selected');
          
          // Mettre à jour l'affichage du jeu sélectionné
          updateSelectedGameInfo();
        }else if(msg === 'btnValidate'){
          let nameGame = $('.boxGame'+gameSelected).data('name');
          window.location.replace(""+nameGame);
        }
      }

      setTimeout(function(){
        lastMsg = '';
      }, 500);
    }
    
    // Ajouter un effet de pulse pour le titre
    $(document).ready(function() {
      $('.titleMenu').addClass('animated');
    });
  </script>

  <style>
    /* Styles pour le tableau des dernières parties */
    .recent-games-table {
      margin-top: 10px;
      max-height: 180px;
      overflow-y: auto;
    }
    
    .compact-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    
    .compact-table th, 
    .compact-table td {
      padding: 6px 4px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .compact-table th {
      font-weight: bold;
      font-size: 0.8rem;
      text-transform: uppercase;
      opacity: 0.8;
    }
    
    .compact-table tbody tr:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .winner-cell {
      color: var(--accent-color);
      font-weight: bold;
    }
    
    .trophy-icon {
      font-size: 0.8rem;
      margin-right: 4px;
    }
    
    .no-games {
      text-align: center;
      opacity: 0.7;
      font-style: italic;
      padding: 30px 0;
    }
    
    /* Personnalisation de la barre de défilement */
    .recent-games-table::-webkit-scrollbar {
      width: 6px;
    }
    
    .recent-games-table::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }
    
    .recent-games-table::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 3px;
    }
  </style>
</body>
</html>
